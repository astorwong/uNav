<html>
<script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
<script src="../dependencies/binary_heap.js"></script>
<script src="graph_definition.js"></script>
<script src="astar.js"></script>

<style>
.container {
  height: auto;
  overflow: hidden;
}

.code  {
  background: #e8f6fe;
  /* the next props are meant to keep this block independent from the other floated one */
  width: auto;
  overflow: hidden;
}

.content_output {
  width: 500px;
  float: right;
  background: #aafed6;
}

img {
  display: block;
  margin-left: auto;
  margin-right: auto;
  height: 200px;
}
</style>

<script>
// let's do some testing!
// var heap = new BinaryHeap(function(x){return x;});
// var life = [10, 3, 4, 8, 2, 9, 7, 1, 2, 6, 5];
// for (var i = 0; i < life.length;++i) {
//   heap.push(i);
// }
// heap.remove(2);
// while (heap.size() > 0)
//   console.log((heap.pop()));

var obj = {
  "type":"Feature",
  "properties":{
    "building_code":"RCH",
    "utility": "Hallway",
    "id":"122H7",
    "name":""
  },
  "geometry":{
    "type":"Point",
    "coordinates":[
      -80.54053791999999,
      43.469295460000005
    ]
  }
};

var obj2 = {
  "type":"Feature",
  "properties":{
    "building_code":"RCH",
    "utility": "Hallway",
    "id": "122H6",
    "name":""
  },
  "geometry":{
    "type":"Point",
    "coordinates":[
      -80.54059842,
      43.469295460000005
    ]
  }
};

var obj3 = {
  "type": "Feature",
  "geometry": {
    "type": "Point",
    "coordinates": [
      -80.540973,
      43.470131,
      1
    ]
  },
  "properties": {
    "building_code": "RCH",
    "id": "120S",
    "utility": "Stairs",
    "name":""
  }
};

var obj4 = {
  "type":"Feature",
  "properties":{
    "building_code":"RCH",
    "utility": "Hallway",
    "id": "10000",
    "name":"Decoy"
  },
  "geometry":{
    "type":"Point",
    "coordinates":[
      1,
      43
    ]
  }
};

var g;

$(function(){
  $("#toggle").on('click', firstClick)

  function firstClick() {
    $("#toggle").prop('value', 'Add Edges');
    g = new Graph();
    g.addNode(g, obj);
    g.addNode(g, obj2);
    g.addNode(g, obj3);
    g.addNode(g, obj4);
    $( "#codesnip" ).append('g.addNode(g, obj);<br>g.addNode(g, obj2);</br>g.addNode(g, obj3);</br>g.addNode(g, obj4);<br>');
    $("#out").html(show(g));
    $("#idea").prop('src', '../images/g_1.png');
    $("#toggle").off('click').on('click', secondClick);
  }

  function secondClick() {
    $("#toggle").prop('value', 'Drop an Edge');
    g.addEdge(g, "RCH122H7", "RCH122H6");
    g.addEdge(g, "RCH122H6", "RCH120S");
    g.addEdge(g, "RCH10000", "RCH120S");
    g.addEdge(g, "RCH10000", "RCH122H6");
    $( "#codesnip" ).append('g.addEdge(g, "RCH122H7", "RCH122H6");<br>g.addEdge(g, "RCH122H6", "RCH120S");<br>g.addEdge(g, "RCH10000", "RCH120S");<br>g.addEdge(g, "RCH10000", "RCH122H6");<br>');
    $("#out").html(show(g));
    $("#idea").prop('src', '../images/g_2.png');

    $("#toggle").off('click').on('click', thirdClick);
  }

  function thirdClick() {
    $("#toggle").prop('value', 'Drop a Node');
    g.dropEdge(g, "RCH10000", "RCH120S");
    $( "#codesnip" ).append('g.dropEdge(g, "RCH10000", "RCH120S");<br>');
    $("#out").html(show(g));
    $("#idea").prop('src', '../images/g_3.png');

    $("#toggle").off('click').on('click', fourthClick);
  }

  function fourthClick() {
    $("#toggle").prop('value', 'Perform A*');
    g.dropNode(g, "RCH10000");
    $( "#codesnip" ).append('g.dropNode(g, "RCH10000");<br>');
    $("#out").html(show(g));
    $("#idea").prop('src', '../images/g_4.png');

    $("#toggle").off('click').on('click', fifthClick);
  }

  function fifthClick() {
    $("#toggle").prop('value', 'Restart');
    $( "#codesnip" ).append('aStar(g, "RCH120S", "RCH122H7");<br>');
    var temp = aStar(g, "RCH120S", "RCH122H7");
    var out = "<b>The best path (by A*) from RCH 120S to RCH 122H7 is: </b><br>";
    $.each(temp.path, function(ind, val){
      out += val;
      if (ind != temp.path.length - 1) {
        out += " -> ";
      }
    });
    out += "<br>with a distance of <b>" + temp.dist + "</b> units.";

    $("#out").html(show(g) + out);
    $("#idea").prop('src', '../images/g_5.png');
    $("#toggle").off('click').on('click', sixthClick);
  }

  function sixthClick() {
    $("#toggle").prop('value', 'Start Adventure!');
    $( "#codesnip" ).html("<p>var g = new Graph();</p>");
    $("#out").html("<p>This is the state of the graph.</p>");
    $("#idea").prop('src', '../images/g_0.png');

    $("#toggle").off('click').on('click', seventhClick);
  }

  function seventhClick() {
    $("#toggle").on('click', firstClick());
  }


  function show(graph){
    var output;
    output = "<p><b>The graph currently has: " + graph._nodeCount + " nodes and " + graph._edgeCount+ " edges.</b><br>";
    output +="<br><b>The nodes are as follows:</b><br>";
    $.each(g._nodes, function(ind,val){
      output += val._id + " at x = " + val._x + " and y = " + val._y + ".<br>";
    });
    output +="<br><b>The edges are as follows:</b><br>";
    $.each(g._adjacency, function(ind,val){
      if (val.length != 0) {
        output += ind + " is connected to ";
        $.each(val, function(i, j){
          output += j.id;
          if(i != val.length - 1){
            output += ", ";
          }
        });
        output += ".<br>";
      }
    });
    output +="</p>";
    return output;
  }
});
</script>

<body>
  <h1>Demo - February 8, 2016</h1>
  <input type="button" id="toggle" value="Start Adventure!"/>

  <img id="idea" src="../images/g_0.png" style="text-align: center">
  <div class="container">
    <div class="content_output" id="out">
      <p>This is the state of the graph.</p>
    </div>

    <div class="code" id="codesnip">
      <p>var g = new Graph();</p>
    </div>
  </div>
</body>
</html>
